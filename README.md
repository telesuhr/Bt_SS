# Bloomberg API バックテストシステム (Bt_SS)

Bloomberg APIを使用して日本株のティックデータを取得し、様々な取引戦略をバックテストするPythonシステムです。

## 🎯 このシステムでできること

1. **リアルタイムデータ取得**: Bloomberg Terminalから日本株のティックデータ・分足データを取得
2. **戦略バックテスト**: 過去データを使って取引戦略の収益性を検証
3. **最適戦略探索**: 複数の戦略・パラメータから最適な組み合わせを発見
4. **市場適応**: 相場状況（上昇・下落・レンジ）に応じて戦略を自動切り替え

## 📋 必要な環境

- **Bloomberg Terminal**: 起動した状態で使用
- **Python 3.8以上**
- **Bloomberg API (blpapi)**: Bloomberg Terminalに付属

## 🚀 クイックスタート

### 1. セットアップ

```bash
# リポジトリをクローン
git clone https://github.com/telesuhr/Bt_SS.git
cd Bt_SS

# 必要なパッケージをインストール
pip install -r requirements.txt
```

### 2. 基本的な使い方

```python
# トヨタ自動車(7203)でバックテストを実行
python main.py
```

### 3. 高度な使い方

```python
# 10銘柄で最適な戦略を探索
python find_best_strategy.py

# 市場環境に応じて戦略を切り替える適応型戦略
python adaptive_strategy.py

# 複数銘柄でデイトレード戦略をテスト
python multi_stock_daytrading.py
```

## 📊 実装済みの取引戦略

### 1. SimpleDayTrading（シンプルデイトレード）
- **エントリー**: 20分間で0.2%以上の価格上昇
- **利確**: +0.3%
- **損切り**: -0.2%
- **特徴**: 1日最大3回取引、14:55に全ポジション決済

### 2. MeanReversion（平均回帰）
- **エントリー**: 価格が平均から大きく乖離（Z-score < -2）
- **決済**: 平均に回帰（|Z-score| < 0.5）
- **特徴**: レンジ相場で効果的

### 3. Breakout（ブレイクアウト）
- **エントリー**: 直近高値を突破
- **利確**: +0.5%
- **損切り**: -0.3%
- **特徴**: トレンド相場で効果的

### 4. AdaptiveStrategy（適応型戦略）
- **強い上昇**: モメンタム戦略
- **レンジ相場**: 平均回帰戦略
- **下落相場**: 逆張りまたは取引停止
- **特徴**: 市場状況を自動判定して戦略切り替え

## 📁 プロジェクト構成

```
Bt_SS/
├── src/                          # ソースコード
│   ├── bloomberg_api/            # Bloomberg API接続
│   │   └── tick_data_fetcher.py # データ取得クラス
│   ├── backtest/                 # バックテストエンジン
│   │   └── engine.py            # 売買シミュレーション
│   ├── strategies/               # 取引戦略
│   │   └── base_strategy.py     # 戦略基底クラス
│   └── technical_indicators/     # テクニカル指標
│       └── indicators_lite.py   # 移動平均、RSI等
├── main.py                       # メインプログラム
├── adaptive_strategy.py          # 市場適応型戦略
├── find_best_strategy.py         # 最適戦略探索
└── reports/                      # バックテスト結果（HTML）
```

## 📈 実際の結果例

### トヨタ自動車 (7203) - SimpleDayTrading戦略
- **期間**: 7日間
- **リターン**: +2.70%
- **シャープレシオ**: 0.61
- **取引回数**: 15回

### 10銘柄での最適戦略探索
- **テスト銘柄**: ソフトバンクG、ソニー、NTT、三菱UFJ等
- **最適戦略**: Breakout戦略（30期間、0.4%閾値）
- **平均リターン**: +0.09%

## ⚠️ 重要な注意事項

1. **実際の取引には使用しないでください**
   - これは研究・教育目的のシステムです
   - 実運用には追加のリスク管理が必要です

2. **Bloomberg Terminal必須**
   - データ取得にはBloomberg Terminalが必要です
   - 有料サービスです

3. **バックテストの限界**
   - 過去の結果は将来を保証しません
   - スリッページや流動性の問題は完全には再現できません

## 🔧 トラブルシューティング

### よくあるエラーと対処法

1. **"Bloomberg API接続失敗"**
   - Bloomberg Terminalが起動しているか確認
   - `blpapi`がインストールされているか確認

2. **文字化け**
   - Windowsの場合、コマンドプロンプトで`chcp 65001`を実行
   - UTF-8エンコーディングを使用

3. **データが取得できない**
   - 銘柄コードが正しいか確認（例: "7203 JT Equity"）
   - 市場時間外の可能性

## 📝 今後の開発予定

- [ ] リアルタイム取引シグナル生成
- [ ] 機械学習を使った戦略最適化
- [ ] ポートフォリオ最適化機能
- [ ] より詳細なリスク分析

## 💡 貢献について

バグ報告や機能提案は[Issues](https://github.com/telesuhr/Bt_SS/issues)にお願いします。

## 📜 ライセンス

このプロジェクトは研究・教育目的で公開されています。
商用利用の際はご相談ください。
